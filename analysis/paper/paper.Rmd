---
title: "Title Goes Here"
author:
  - Yichun Chen:
      email: yichun33@uw.edu
      institute: [UofO]
      correspondence: true
  - Ben Marwick:
      email: fl@another.edu
      institute: [UofA]
      correspondence: false
institute:
  - UofO: University of One Place
  - UofA: University of Another Place
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---


<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

# Introduction

Here is a citation [@Marwick2017]

Gender under-representation and inequality has long existed, from under-representation in childrenâ€™s picture books to academic publications (Hamilton et al. 2006; Tushingham et al. 2017). When talking about inequality in academic fields, we usually refer to the disproportionality between men and women in the field, including archaeology. Women are often underrepresented due to the lack of support women receive in academic fields (Xu 2008). When focusing on the field of archaeology, we can see that gender imbalance still occurs in archaeology and that seems to impact the kind of publications that are done in the field (Bardolph et al. 2016). As we can see in the authorship of the main authors from the Journal of Field Archaeology, 78% of them are men (Heath-Stout 2020). When looking at gender ratios among the membership in Society for California Archaeology from 1967 to 2016, Tushingham et al. (2017) report a trend of women increasingly maintaining their society membership and the gender gap is almost gone. In this study we investigate gender ratios of presenters at major archaeological conferences. We extend the work of Tushingham et al. (2017) with a study of gender ratios of presenters at meetings of the Society of American Archaeology (SAA, 2016-2019), the European Association of Archaeologists (EAA, 2018) and the Computer Applications and Quantitative Methods in Archaeology (CAA, 2017)  We explore how gender ratios vary over time and between these conferences. We examine the influence of the gender of the presenter on the topics that they present on.

# Background



```{r}
library(here)
# column names should be:
# session, FirstName, AbstractTitle

SAA18 <- readxl::read_excel(here::here("analysis/data/raw-data/2018 SAA Title.xlsx"))
EAA18 <- readxl::read_excel(here::here("analysis/data/raw-data/2018 EAA.xlsx")) 
CAA18 <- readxl::read_excel(here::here("analysis/data/raw-data/2018 CAA.xlsx"))

SAA18_row <- nrow(SAA18)      
EAA18_row <- nrow(EAA18)      
CAA18_row <- nrow(CAA18)      

```

# Methods

We collected lists of the people that presented research at recent SAA (2018 with `r SAA18_row` presenters, EAA (2018 with `r EAA18_row` presenters) and CAA (2018 with `r CAA18_row` presenters) conferences. We obtained publicly available programs of these conferences and also tidied the data into a rectangular form with variables including the primary author's first name, last name and the title of their presentation. We used R and the gender package (Mullen 2018; Mihaljevic 2019; Belvis et al. 2015) to predict the gender of all first-named presenters in our sample. We used the gender package to identify a first name as male or female, based on a probability scale computed from government records of name-gender data, specifically US Social Security Administration (SSA) baby name data (Mullen 2019). This method has the advantage of speed and ease of automation, but also some substantial limitations. We are only able to infer gender into binary male/female genders and assign probabilities for the first names into these categories. This has the unfortunate result of excluding other genders from the results, and we encourage conference organizers to collect gender data directly from participants to improve the representation of minority genders in future studies. The package often fails to classify non-English names, as the SSA data the package uses are mostly in English names. This means that people with non-English names are underrepresented in our results. To remove names where gender is ambiguous, which we define as a similar proportion of males and females having that name in the SSA data, we excluded names where the difference in proportions was less than 0.47, a figure we obtained by exploratory data analysis. It is important to note that the gender designations here are not self-identified by the presenters, but are computed probabilistically. Better quality data will come if presenters self-identify their gender, but we have no alternative because currently these data are not available. Our hope is that this work, despite its many limitations, will stimulate the collection of more reliable, justifiable, and useful data by conference organisers. 

We are also interested in whether there is a variation in topic choices between these two genders in archaeological conferences. To do this we have used topic modeling, which is a method to automatically find related groups of words that resemble 'themes' or 'topics'. This approach does not treat one topic, which consists of many words, as separate from another topic. That is, a word can be present in many topics but with differs weightings. When generating topic models, we have to first decide on the number of topics that the method will identify in our texts. We then create a topic model for all our texts, this will assign all words in every document into our set number of topics, and assign each word a probability based on its per-topic-per-word probability. To visualise the topic model we use the top 10 words within each topic as keywords to represent each topic. We excluded words that are common in the field of archaeology or have little semantic value, for example, 'the', 'a', 'el', 'al', 'archaeology', etc. We generated one topic model per conference. Each presentation at each conference is then assigned a vector of topic probabilities. 

We then tried another process of topic modeling called Structural Topic Model (STM) which is very similar to the LDA we have described above. The main advantage for us is that, the STM allows us to include, alongside the normal topic modeling process, other metadata. This process "attaches" the metadata to the collection of texts that we will then perform topic modeling process. It is important to note that we have used the stm package that also includes the ability to calculate the number of topics that is best suited for STM modeling (Roberts 2019). The fact that we are allowed to do this allows us to perform covariate analysis (Roberts et al. 2013). This basically means that we can examine the relationship between the topics and some covariates/variables of interest. We can define the genders of males and females and then analyze the prevelance of these two categories in accordance with the topics that the stm package determined (Roberts 2019). The analysis is used also with probabilities given to the texts to see if the most occuring of some text seems to be "attached" to one gender over another.

To explore the relationship between gender and topics we identified the most prominent topic for each presentation... 

# Results
```{r}
number_of_papers_saa_2018 <-  ...
```



In our analysis we have a total paper distribution of SAA with `SAA18_row` papers, EAA with `EAA18_row` papers and CAA with `CAA18_row` of papers. For SAA, we have `female_count_SAA18` females and `male_count_SAA18` males, for EAA, we have `female_count_EAA18` females and `male_count_EAA18` males, finally for CAA, we have `female_count_CAA18` females and `male_count_CAA18` males. This means that our ratio of females to males in each of the cnferences are as follows, SAA with `female_to_male_SAA18`, EAA with `female_to_male_EAA18` and CAA with `female_to_male_CAA18`. As noted earlier out data set did not originally include the gender of each presenters' thus we are only able to assign gender to presenters based on their first names, and this means that some people are not able to receive a gender due to our filter, in SAA we are forced to drop `missing_gender_SAA18` number of topics,
`missing_gender_EAA18` topics in EAA, `missing_gender_CAA18` topics in CAA.


We have used the built in function of the R package stm to calculate the number of topics that is best for each conferences, for SAA we have generated a total of `SAA_stm_topic_number` topics, for EAA we have generated a total of `EAA_stm_topic_number` topics, and for CAA we hve generated a total of `CAA_stm_topic_number`.

First let's examine the figure for SAA 2018's stm topic plot that tells us where a topic seems to fall under. One of the main difference that we can see between the topics of the genders are the locations that the presenters are interested in, it seems like that females are more likely to have a topic at a specific region such as mesoamerica, arizona and national parks, while males are more likely to have a topic that are in the western regions. Next, let's take a look at EAA's difference between females and males. Although both red-marked topics include topics with "mediterranean", it is important to distinguish that females seems to be focusing on western mediterranean while males seems to be focusing on northern mediterranean. Another main difference that we have noticed is that males tends to have topics that are related to architect, while the topic regarding research methods using isotopes seems to be more popular for females. Lastly, in CAA's stm topic plot we can see a clearer pattern from the topics marked in red. For females from CAA, we see that topics that are associated with Geographic Information System (GIS) are more likely to be a topic for female presenters. Another female-associated topics from the CAA topic plot is topics that includes the word women, excav and inform. As for males from CAA, there doesn't seem to have a specific word that is more associated with males besides the word enviorn.



```{r, eval=FALSE}

# make the custom function available here in this Rmd file
source(here::here("analysis/paper/functions-for-gender.R"))

# compute gender model, take a few minutes...
SAA18_gm <- get_the_gender_data(SAA18)
saveRDS(SAA18_gm, here::here("analysis/data/derived-data/SAA18_gender_model.rds")) # ok

EAA18_gm <- get_the_gender_data(EAA18, first_name_appears_first = FALSE)
saveRDS(EAA18_gm, here::here("analysis/data/derived-data/EAA18_gender_model.rds"))

CAA18_gm <- get_the_gender_data(CAA18)
saveRDS(CAA18_gm, here::here("analysis/data/derived-data/CAA18_gender_model.rds"))
```

```{r, eval=FALSE}
SAA18_gender <-
  readRDS(here::here("analysis/data/derived-data/SAA18_gender_model.rds"))
EAA18_gender <-
  readRDS(here::here("analysis/data/derived-data/EAA18_gender_model.rds"))
CAA18_gender <-
  readRDS(here::here("analysis/data/derived-data/CAA18_gender_model.rds"))

female_count_SAA18 <- 
  length(which(SAA18_gender$gender == "female"))
male_count_SAA18 <- 
  length(which(SAA18_gender$gender == "male"))
female_to_male_SAA18 <- 
  female_count_SAA18 / male_count_SAA18
missing_gender_SAA18 <- 
  SAA18_row - (female_count_SAA18 + male_count_SAA18)
  

female_count_EAA18 <- 
  length(which(EAA18_gender$gender == "female"))
male_count_EAA18 <- 
  length(which(EAA18_gender$gender == "male"))
female_to_male_EAA18 <- 
  female_count_EAA18 / male_count_EAA18
missing_gender_EAA18 <-
  EAA18_row - (female_count_EAA18 + male_count_EAA18)

female_count_CAA18 <- 
  length(which(CAA18_gender$gender == "female"))
male_count_CAA18 <- 
  length(which(CAA18_gender$gender == "male"))
female_to_male_CAA18 <- 
  female_count_CAA18 / male_count_CAA18
missing_gender_CAA18 <-
  CAA18_row - (female_count_CAA18 + male_count_CAA18)
```

```{r, eval=FALSE}

# make the custom function available here in this Rmd file
source(here::here("analysis/paper/function-for-structural-topic-model.R"))

# compute and save the topic model for each conf, takes quite a long time
SAA18_stm <- 
  stm_model_and_plot(conf_paper_titles = SAA18, 
                     conf_gender_results = SAA18_gm, 
                     max.em.its = 1000)

saveRDS(SAA18_stm, here::here("analysis/data/derived-data/SAA18_topic_model_and_plot.rds"))

CAA18_stm <-   
  stm_model_and_plot(conf_paper_titles = CAA18, 
                     conf_gender_results = CAA18_gm, 
                     lower_thresh = 3,
                     max.em.its = 1000)

saveRDS(CAA18_stm, here::here("analysis/data/derived-data/CAA18_topic_model_and_plot.rds"))

EAA18_stm <- 
  stm_model_and_plot(conf_paper_titles = EAA18, 
                     conf_gender_results = EAA18_gm, 
                     first_name_appears_first = FALSE,
                     max.em.its = 1000)

saveRDS(EAA18_stm, here::here("analysis/data/derived-data/EAA18_topic_model_and_plot.rds"))
```

```{r}
# get plots

# SAA -----
SAA18_stm_plot <- 
  readr::read_rds(here::here("analysis/data/derived-data/SAA18_topic_model_and_plot.rds"))

SAA18_stm_plot$plot
ggsave(here::here("analysis/figures/SAA18_stm_plot.png"), height = 7, width = 6)

SAA_stm_topic_number <-
  SAA18_stm_plot$model$settings$dim$K

# CAA -----
CAA18_stm_plot <- 
  readr::read_rds(here::here("analysis/data/derived-data/CAA18_topic_model_and_plot.rds"))

CAA18_stm_plot$plot
ggsave(here::here("analysis/figures/CAA18_stm_plot.png"), height = 7, width = 6)

CAA_stm_topic_number <-
  CAA18_stm_plot$model$settings$dim$K

# EAA -----
EAA18_stm_plot <- 
  readr::read_rds(here::here("analysis/data/derived-data/EAA18_topic_model_and_plot.rds"))

EAA18_stm_plot$plot
ggsave(here::here("analysis/figures/EAA18_stm_plot.png"), height = 7, width = 6)

EAA_stm_topic_number <-
  EAA18_stm_plot$model$settings$dim$K
```



# Discussion

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->
\newpage

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:
u
```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
