---
title: "Title Goes Here"
author:
  - Yichun Chen:
      email: yichun33@uw.edu
      institute: [UofO]
      correspondence: true
  - Ben Marwick:
      email: fl@another.edu
      institute: [UofA]
      correspondence: false
institute:
  - UofO: University of One Place
  - UofA: University of Another Place
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::html_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---


<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

# Introduction

Gender under-representation and inequality has long existed in science, from under-representation of women and minority genders in school text books to academic publications [@hamilton2006gender; @tushingham2017peer]. Women are often under-represented for several reasons, including stereotyping that unfairly underestimates individuals' abilities, which often leads to lack of support for women in academic fields [@xu2008gender]. In this paper we explore the relationship between gender and research topics to determine if women and men tend to focus more on certain topics than others. 

We used a computational method to identify topics from the titles of presentations delivered at meetings of the Society of American Archaeology (SAA, 2016-2019), the European Association of Archaeologists (EAA, 2018) and the Computer Applications and Quantitative Methods in Archaeology (CAA, 2017). We analysed the covariance of topics and genders of presenters to explore how gender ratios vary between these conferences and by topics. 

# Background

When focusing on the field of archaeology, we can see that gender imbalance still occurs in archaeology and that seems to impact the kind of publications that are done in the field [@bardolph2014critical]. @rodriguez2018gender studied gender balance among 309 authors of 299 publications produced during 1978-2016 by the Atapuerca Project, a large archaeo-palaeontological project in Burgos, Spain. They 'manually defined' the gender of each author, and found 13 articles authored exclusively by women, 34.8% of papers have women as first-authors, and overall, 35.9% of all authors are women [@rodriguez2018gender]. Over time, they observed a trend of increasing numbers of papers that include women as authors, numbers of paper lead by women as the first author, and increases in the ratio of female to male authors in group-authored papers. They did not make any observations about relationships between gender and topics.

Another similar imbalance can be seen in terms of the authorship of articles or papers written. For example, for the authorship of the first authors of 1,104 articles published in the _Journal of Field Archaeology_ during 1974â€“2018, 72% of them are men [@heath2020guest]. We have extended the study of ratios of authorships in the field of archaeology by specifically focusing on the gender imbalance that occurs in the topics that the authors present in major archaeological conferences.

When looking at gender ratios among the membership in Society for California Archaeology from 1967 to 2016, @tushingham2017peer report a trend of women increasingly maintaining their society membership and the gender gap being shortened over the years. @tushingham2017peer focuses on 3 articles from journals published in _Journal of California and Great Basin Anthropology/ Journal of California Anrchaeology_ (JCGBA/JCA) and _California Archaeology_ (CA) and a non-peer reviewed Society for California Archaeology _Poroceedings_. When looking at the percentage of female lead authors of a total of 2617 authors, the proportion of female lead authors have been increasing statistically significantly with p < 0.01 from the Cochran-Armitage chi-square test for trend (@tushingham2017peer). This similar trend of closing the gender gap can also be seen in women's pursue of higher degree in archaeology, out of a total of 217 surveryed, we see that in the 1950s females have 0% that are what the authors considered as decade of highest degree while in the 1980s it grew to 9.7% and eventually to 46.1% in 2010s (@vanderwarker2018ucsb). In the same study by @vanderwarker2018uscb, it is important to note that data collected from University of California, Santa Barbara Gender Equity Project shows that there are still imbalance as a result of different pay rates, for example, breaking down annual income by 20000 groupings, there is a trend that women outpoportions men in the lower bracket of less than 20000, 21000 to 40000 and 41000 to 60000 where as men outproportions women in the upper bracket of 61000 to 80000 and 81000 to 100000 and greater than 100000 (@vanderwarker2018uscb). 

Something about Twitter

```{r}
library(here)
# column names should be:
# session, FirstName, AbstractTitle

SAA18 <- readxl::read_excel(here::here("analysis/data/raw-data/2018 SAA Title.xlsx"))
EAA18 <- readxl::read_excel(here::here("analysis/data/raw-data/2018 EAA.xlsx")) 
CAA18 <- readxl::read_excel(here::here("analysis/data/raw-data/2018 CAA.xlsx"))

SAA18_row <- nrow(SAA18)      
EAA18_row <- nrow(EAA18)      
CAA18_row <- nrow(CAA18)  

library(gender)
lynne_gender <-  gender("Lynne")


```

# Methods

We requested from conference organisers spreadsheets files of the publicly available program information for three major archaeology meetings held in 2018: the Society of American Archaeology (SAA, 2016-2019), the European Association of Archaeologists (EAA, 2018) and the Computer Applications and Quantitative Methods in Archaeology (CAA, 2017). 

We estimated the gender of the first-named speaker for each presentation using the R programming language and the gender package [@lincolngender; @mihaljevic2019reflections; @blevins2015jane]. We inferred the gender of personal names by looking each name up in the US Social Security Administration (SSA) baby name data, and calculating the overall probability that a given name was male or female [@mihaljevic2019reflections]. If the proportion of people in the SSA data with a certain given name are recorded as female is 0.5 or higher, we predicted the gender of the presenter with this name as female. For example, in the SSA dataset the the name "Lynne" returns `r lynne_gender$proportion_male` as proportion of individuals with this name who are recorded as male, and `r lynne_gender$proportion_female` as the proportion female, thus we inferred that people in our conference data who are called Lynne are women. 

This method of inferring gender has the advantage of speed, transparency and reproducibility, but also some substantial limitations that are important to be upfront about. We are only able to infer binary male/female genders and assign the first names into these two categories. This has the unfortunate result of excluding other genders from the results, excluding them from our analysis. We considered it impractical and invasive to write to each first-named presented to request their gender information. A further limitation of our approach is that it sometimes fails to classify non-English names at all, as the SSA data consists mostly of English names. This means that people with non-English names are underrepresented in our results. It is important to note that the inferences of gender presented here are not self-identified by the presenters, but are computed probabilistically. Better quality and more representative data would result if presenters self-identified their gender, but currently these data are not available. We encourage conference organizers to collect gender data directly from participants to improve the representation of minority genders in future studies. Our hope is that this work, despite its many limitations, will stimulate the collection of more reliable, justifiable, and useful data by conference organisers. 

We identified the topic of each presentation by generating a structural topic model for all the presentations in each of the three conferences. Topic modeling is a machine learning method to automatically find related groups of words that resemble traditional 'themes' or 'topics' in a collection of documents.Topic models are 'unsupervised' methods because they infer rather than assume the content of the topics in a collection of documents, and they have been used across a variety of fields [add citations]. This approach uses  latent Dirichlet allocation to allow every word to be present in every topic, but with different weightings, such that the most heavily weighted 5-10 words of a topic often capture the essence of the topic as a coherent and familiar concept. When generating topic models, we have to first decide on the number of topics that the method will identify in our texts. The topic modeling algorithm then  assigns all words in every document into our set number of topics, and assigns each word a probability based on its per-topic-per-word probability, and each document (i.e. conference presentation title) is assigned a distribution of topics with different weights. To visualise the topic model output we use the 10 words with the highest weighting within each topic as keywords to represent each topic. In generating the topic model we excluded words that are common in English generally or in archaeology and so have little semantic value, for example, 'the', 'a', 'el', 'al', 'archaeology', etc.  

A structural topic model (STM) allows us to include, alongside the typical topic modeling process, other document-level metadata to analyse covariance between topics and metadata [@roberts2019package]. Covariates of interest can be included into the prior distributions for document-topic proportions and
topic-word distributions using a standard regression model (cite this one: http://scholar.harvard.edu/files/dtingley/files/topicmodelsopenendedexperiments.pdf). This means that we can examine the relationship between the topics and document-level variables of interest. In our case, we computed the relationship between the inferred the gender of the first-named presenter for each presentation, and the distribution of topics in each presentation. When we observed the topics for each presentation, we generated a regression where the topic is the outcome variable, and gender is the explanatory variable. This regression gives us insights into whether gender caused archaeologists to spend a larger portion of their presentation on a particular topic.

# Results


```{r, eval=FALSE}

# make the custom function available here in this Rmd file
source(here::here("analysis/paper/functions-for-gender.R"))

# compute gender model, take a few minutes...
SAA18_gm <- get_the_gender_data(SAA18)
saveRDS(SAA18_gm, here::here("analysis/data/derived-data/SAA18_gender_model.rds")) # ok

EAA18_gm <- get_the_gender_data(EAA18, first_name_appears_first = FALSE)
saveRDS(EAA18_gm, here::here("analysis/data/derived-data/EAA18_gender_model.rds"))

CAA18_gm <- get_the_gender_data(CAA18)
saveRDS(CAA18_gm, here::here("analysis/data/derived-data/CAA18_gender_model.rds"))
```

```{r, eval=FALSE}

# make the custom function available here in this Rmd file
source(here::here("analysis/paper/function-for-structural-topic-model.R"))

SAA18_gm <- readr::read_rds(here::here("analysis/data/derived-data/SAA18_gender_model.rds")) 
EAA18_gm <- readr::read_rds(here::here("analysis/data/derived-data/EAA18_gender_model.rds"))
CAA18_gm <- readr::read_rds(here::here("analysis/data/derived-data/CAA18_gender_model.rds"))

# compute and save the topic model for each conf, takes quite a long time
SAA18_stm <- 
  stm_model_and_plot(conf_paper_titles = SAA18, 
                     conf_gender_results = SAA18_gm, 
                     max.em.its = 1000)

saveRDS(SAA18_stm, here::here("analysis/data/derived-data/SAA18_topic_model_and_plot.rds"))

CAA18_stm <-   
  stm_model_and_plot(conf_paper_titles = CAA18, 
                     conf_gender_results = CAA18_gm, 
                     lower_thresh = 3,
                     max.em.its = 1000)

saveRDS(CAA18_stm, here::here("analysis/data/derived-data/CAA18_topic_model_and_plot.rds"))

EAA18_stm <- 
  stm_model_and_plot(conf_paper_titles = EAA18, 
                     conf_gender_results = EAA18_gm, 
                     first_name_appears_first = FALSE,
                     max.em.its = 1000)

saveRDS(EAA18_stm, here::here("analysis/data/derived-data/EAA18_topic_model_and_plot.rds"))
```


```{r}
# get plots
library(tidyverse)

# SAA -----
SAA18_stm_plot <- 
  readr::read_rds(here::here("analysis/data/derived-data/SAA18_topic_model_and_plot.rds"))

SAA18_stm_plot$plot
ggplot2::ggsave(here::here("analysis/figures/SAA18_stm_plot.png"), 
       height = 7, 
       width = 6)

SAA_stm_topic_number <-
  SAA18_stm_plot$model$settings$dim$K
SAA_stm_topic_number_significant_covary <- 
  nrow(layer_data(SAA18_stm_plot$plot, 3))

# CAA -----
CAA18_stm_plot <- 
  readr::read_rds(here::here("analysis/data/derived-data/CAA18_topic_model_and_plot.rds"))

CAA18_stm_plot$plot
ggsave(here::here("analysis/figures/CAA18_stm_plot.png"), height = 7, width = 6)

CAA_stm_topic_number <-
  CAA18_stm_plot$model$settings$dim$K
CAA_stm_topic_number_significant_covary <- 
  nrow(layer_data(CAA18_stm_plot$plot, 3))

# EAA -----
EAA18_stm_plot <- 
  readr::read_rds(here::here("analysis/data/derived-data/EAA18_topic_model_and_plot.rds"))

EAA18_stm_plot$plot
ggsave(here::here("analysis/figures/EAA18_stm_plot.png"), height = 7, width = 6)

EAA_stm_topic_number <-
  EAA18_stm_plot$model$settings$dim$K
EAA_stm_topic_number_significant_covary <- 
  nrow(layer_data(EAA18_stm_plot$plot, 3))
```

```{r, eval=TRUE}
SAA18_gender <-
  readRDS(here::here("analysis/data/derived-data/SAA18_gender_model.rds"))
EAA18_gender <-
  readRDS(here::here("analysis/data/derived-data/EAA18_gender_model.rds"))
CAA18_gender <-
  readRDS(here::here("analysis/data/derived-data/CAA18_gender_model.rds"))

count_gendered_SAA18 <- nrow(SAA18_gender)
perc_gendered_SAA18 <- round(nrow(SAA18_gender) / SAA18_row, 2) * 100
female_count_SAA18 <- 
  length(which(SAA18_gender$gender == "female"))
male_count_SAA18 <- 
  length(which(SAA18_gender$gender == "male"))
female_to_male_SAA18 <- 
  round(female_count_SAA18 / male_count_SAA18,1)
missing_gender_SAA18 <- 
  SAA18_row - (female_count_SAA18 + male_count_SAA18)
  
count_gendered_EAA18 <- nrow(EAA18_gender)
perc_gendered_EAA18 <- round(nrow(EAA18_gender) / EAA18_row, 2) * 100
female_count_EAA18 <- 
  length(which(EAA18_gender$gender == "female"))
male_count_EAA18 <- 
  length(which(EAA18_gender$gender == "male"))
female_to_male_EAA18 <- 
  round(female_count_EAA18 / male_count_EAA18, 1)
missing_gender_EAA18 <-
  EAA18_row - (female_count_EAA18 + male_count_EAA18)

count_gendered_CAA18 <- nrow(CAA18_gender)
perc_gendered_CAA18 <- round(nrow(CAA18_gender) / CAA18_row, 2) * 100
female_count_CAA18 <- 
  length(which(CAA18_gender$gender == "female"))
male_count_CAA18 <- 
  length(which(CAA18_gender$gender == "male"))
female_to_male_CAA18 <- 
  round(female_count_CAA18 / male_count_CAA18, 1)
missing_gender_CAA18 <-
  CAA18_row - (female_count_CAA18 + male_count_CAA18)
```

In the SAA data we found a total of `r prettyNum(SAA18_row, big.mark = ",")` presentations. Of these we could identify the first-named author of `r count_gendered_SAA18` (`r perc_gendered_SAA18`%) presentations as either men (n=`r male_count_SAA18`) or women (n=`r female_count_SAA18`). For the CAA meeting we have `r prettyNum(CAA18_row, big.mark = ",")` presentations, and `r count_gendered_CAA18` (`r perc_gendered_CAA18`%) first-named authors could be classified as either men (n=`r male_count_CAA18`) or women (n=`r female_count_CAA18`). For the EAA data we have `r prettyNum(EAA18_row, big.mark = ","` presentations, and `r count_gendered_EAA18` (`r perc_gendered_EAA18`%) where the first author could be classified as either a man (n=`r male_count_EAA18`) or woman (n=`r female_count_EAA18`). This results in similar women-to-men ratios for the SAA (`r female_to_male_SAA18`) and EAA (`r female_to_male_EAA18`), but much lower for the CAA (`r female_to_male_CAA18`).

In the SAA presentations we identified the optimum number of topics as `r SAA_stm_topic_number`, with `r SAA_stm_topic_number_significant_covary` of these showing non-random co-variance with the gender of the first-named presenter. One of the main difference that we can see between the topics of the genders are the locations that the presenters are interested in. Women are more likely to have a topic at a specific region such as Mesoamerica, Arizona and national parks, while men are more likely to have a topic that are in the western regions.

For EAA we generated a total of `r EAA_stm_topic_number` topics, with `r EAA_stm_topic_number_significant_covary` of these showing non-random co-variance with the gender of the first-named presenter. Although topics  significantly associated with men and women both include the word "Mediterranean", it is important to distinguish that females seems to be focusing on western Mediterranean while males seems to be focusing on northern Mediterranean Another  difference  is that males tends to have topics that are related to architecture, while the topic regarding research methods using isotopes seems to be more popular for females.


For CAA we generated a total of `r CAA_stm_topic_number` topics, with `r CAA_stm_topic_number_significant_covary` of these showing non-random co-variance with the gender of the first-named presenter. In CAA's stm topic plot we can see a clearer pattern from the topics marked in red. For females from CAA, we see that topics that are associated with Geographic Information System (GIS) are more likely to be a topic for female presenters. Another female-associated topics from the CAA topic plot is topics that includes the word women, excav and inform. As for males from CAA, there doesn't seem to have a specific word that is more associated with males besides the word enviorn.






# Discussion

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->
\newpage

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:
u
```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
